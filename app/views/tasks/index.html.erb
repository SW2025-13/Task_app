<h1>タスク一覧</h1>

<div style="margin-bottom: 15px; display: flex; gap: 10px;">
  <!-- 新規作成ボタン -->
  <%= link_to "＋ 新規タスクを作成", new_task_path,
      class: "btn",
      style: "padding: 8px 12px; background: #4CAF50; color: white; border-radius: 5px; text-decoration: none;" %>

  <%= button_to "ログアウト", logout_path,
      method: :delete,
      class: "btn",
      form: { style: "display: inline;" },
      style: "padding: 8px 12px; background: #ff4d4d; color: white; border-radius: 5px; border: none;" %>
</div>

<table border="1" cellpadding="8">
  <thead>
    <tr>
      <th>タスク名</th>
      <th>
        <%= link_to "期限", tasks_path(sort: "deadline", direction: params[:sort] == "deadline" && params[:direction] == "asc" ? "desc" : "asc") %>
      </th>
      <th>
        <%= link_to "労力", tasks_path(sort: "effort", direction: params[:sort] == "effort" && params[:direction] == "asc" ? "desc" : "asc") %>
      </th>
      <th>説明</th>
      <th>
        <%= link_to "優先度", tasks_path(sort: "priority", direction: params[:sort] == "priority" && params[:direction] == "asc" ? "desc" : "asc") %>
      </th>
      <th>完了</th>
      <th>削除</th>
      <th>編集</th>
    </tr>
  </thead>

  <tbody>
    <% @tasks.each do |task| %>
      <tr class="<%= 'expired' if task.deadline.present? && task.deadline < Date.today %>">
        <td><%= task.title %></td>
        <td><%= task.deadline %></td>
        <td><%= task.effort %></td>
        <td><%= task.content %></td>
        <td><%= task.priority %></td>

        <!-- 完了チェック -->
        <td>
          <%= form_with url: toggle_done_task_path(task), method: :post, local: true do %>
            <%= check_box_tag :done, 1, task.done, onclick: "this.form.submit();" %>
          <% end %>
        </td>

        <!-- 削除 -->
        <td>
          <%= link_to "削除", task_path(task), method: :delete, data: { confirm: "削除しますか?" } %>
        </td>

        <!-- 編集 -->
        <td>
          <%= link_to "編集", edit_task_path(task) %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

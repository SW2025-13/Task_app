<div style="text-align: center; margin-top: 60px;">

  <h1>タスク一覧</h1>

  <% if notice %>
    <p style="color: green;"><%= notice %></p>
  <% end %>

  <!-- 上部ボタン -->
  <div style="
    margin: 20px auto;
    display: flex;
    justify-content: center;
    gap: 12px;
  ">
    <%= link_to "＋ 新規タスクを作成", new_task_path,
        style: "
          padding: 8px 12px;
          background: #4CAF50;
          color: white;
          border-radius: 5px;
          text-decoration: none;
        " %>

    <%= button_to "ログアウト", logout_path,
        method: :delete,
        form: { style: "display: inline;" },
        style: "
          padding: 8px 12px;
          background: #ff4d4d;
          color: white;
          border-radius: 5px;
          border: none;
          cursor: pointer;
        " %>
  </div>

  <!-- テーブル -->
  <div style="overflow-x: auto;">
    <table border="1" cellpadding="8"
      style="
        margin: 0 auto;
        border-collapse: collapse;
        min-width: 800px;
        text-align: left;
      ">
      <thead>
        <tr>
          <th>タスク名</th>
          <th><%= link_to "期限", tasks_path(sort: "deadline") %></th>
          <th><%= link_to "労力", tasks_path(sort: "effort") %></th>
          <th>説明</th>
          <th><%= link_to "優先度", tasks_path(sort: "priority") %></th>
          <th>完了</th>
          <th>削除</th>
          <th>編集</th>
        </tr>
      </thead>

      <tbody>
        <% @tasks.each do |task| %>
          <tr>
            <td>  <!-- タイトル -->
              <%= link_to task.title, task_path(task),
                  style: "
                    color: #2196F3;
                    text-decoration: none;
                    font-weight: bold;
                  " %>
            </td>
            <td>
              <% if task.deadline.present? && task.deadline < Date.today %>
                <span style="color: red; font-weight: bold;">
                  <%= task.deadline %>（期限切れ）
                </span>
              <% elsif task.deadline.present? && task.deadline <= Date.today + 3 %>
                <span style="color: orange;">
                  <%= task.deadline %>（間近）
                </span>
              <% else %>
                <%= task.deadline %>
              <% end %>
            </td>
            <td><%= task.effort %></td>
            <td><%= task.content %></td>
            <td><%= task.priority %></td>

            <td style="text-align: center;">
              <%= form_with url: toggle_done_task_path(task), method: :post, local: true do %>
                <%= check_box_tag :done, 1, task.done, onclick: "this.form.submit();" %>
              <% end %>
            </td>

            <td style="text-align: center;">
              <%= link_to "削除",
                task_path(task),
                data: {
                  turbo_method: :delete,
                  turbo_confirm: "削除しますか？"
                } %>
            </td>

            <td style="text-align: center;">
              <%= link_to "編集", edit_task_path(task) %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

</div>
